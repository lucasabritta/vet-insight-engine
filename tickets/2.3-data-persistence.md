# Ticket 2.3: Data Persistence

**Phase:** 2 - Core Processing Logic

**Description:**
Set up persistent data storage for document metadata and extracted structured records.

## Requirements

- [ ] Set up PostgreSQL database
- [ ] Design database schema for storing document metadata
- [ ] Design database schema for storing extracted JSON results
- [ ] Implement ORM/database abstraction layer (SQLAlchemy recommended)
- [ ] Create migration scripts for schema versioning
- [ ] Implement connection pooling and error handling
- [ ] Set up database configuration management
- [ ] Implement UPDATE /documents/{id} endpoint to update document structured information
- [ ] Write unit tests for database operations (CRUD)
- [ ] Write integration tests with PostgreSQL
- [ ] Test migration scripts and schema versioning

## Acceptance Criteria

- PostgreSQL is running and accessible
- Database schema supports storing documents and extraction results
- ORM is properly configured with FastAPI
- Migration system works correctly for future schema updates
- Database connections are properly managed
- Data integrity constraints are in place

## Dependencies

- Ticket 2.2: LLM Integration for Structured Extraction

## Notes

- Use SQLAlchemy for ORM to maintain clean architecture
- Implement proper indexing for query performance
- Consider backup and recovery strategies
- Document database schema and relationships
- Integration tests use PGlite (lightweight PostgreSQL in-memory) for testing
  - Provides PostgreSQL compatibility without separate server
  - All PostgreSQL features work identically in tests and production
  - Connection string: postgresql://postgres:postgres@localhost/test_db
